
#Procesamiento de variables
#llamada de paquetes
install.packages("pacman")
pacman::p_load(dplyr, sjmisc, car, sjlabelled, stargazer, haven)

#selección de variables
proc_data <- elsoc_2021 %>% select(m0_edad, #Edad
                                   r09, #Grado de simpatía por extranjeros que viven en Chile
                                   r11, #Grado de ansiedad por interacción con Extranjeros
                                   r12_03, #Grado de acuerdo: Chile pierde su identidad con la llegada de extranjeros 
                                   r12_04, #Grado de acuerdo: La llegada de extranjeros aumenta el desempleo
                                   r16, #Grado de confianza en extranjeros
                                   r18_01, #Grado de acuerdo: fomentar migración calificada
                                   r18_02, #Acceso igualitario a salud para nacionales y extranjeros
                                   c37_05, #Grado de acuerdo: Restricciones ingreso de inmigrantes
                                   )
#Descriptivos de las variables escogidas.
frq(proc_data$m0_edad) 
frq(proc_data$r09) 
frq(proc_data$r11)
frq(proc_data$r12_03)
frq(proc_data$r12_04)
frq(proc_data$r16)
frq(proc_data$r18_01)
frq(proc_data$r18_02)
frq(proc_data$c37_05) #Al todas estar en un orden ascendente se decide no reordenar las categorías de las variables
##Se transformaran los -999, -888, -777 y -666 en NA
proc_data <- proc_data %>% set_na(., na = c(-999, -888, -777, -666))
###Cambio de nombres de las variables
proc_data <- proc_data %>% rename("edad" = m0_edad,
                                  "simpatia_extranjeros" = r09,
                                  "ansiedad_interaccion_inmg" = r11,
                                  "acuerdo_perdida_de_identidad" = r12_03,
                                  "acuerdo_aumento_desempleo" = r12_04,
                                  "confianza_en_extranjeros" = r16,
                                  "fomentar_migracion_calificada" = r18_01,
                                  "acceso_igualitario_salud" = r18_02,
                                  "acuerdo_restriccion_inmigrantes" = c37_05)
####Por último, se cambian las etiquetas de las variables
proc_data$Edad <- set_label(x = proc_data$Edad, label = "Edad")
proc_data$simpatia_extranjeros <- set_label(x = proc_data$simpatia_extranjeros, label = "Nivel de simpatía por inmigrantes")
proc_data$ansiedad_interaccion_inmg <- set_label(x = proc_data$ansiedad_interaccion_inmg, label = "Nivel de ansiedad por interactuar con inmigrantes")
proc_data$acuerdo_perdida_de_identidad <- set_label(x = proc_data$acuerdo_perdida_de_identidad, label = "Nivel de acuerdo con que la inmigración afecta la identidad nacional")
proc_data$acuerdo_aumento_desempleo <- set_label(x = proc_data$acuerdo_aumento_desempleo, label = "Nivel de acuerdo con que la inmigración genera desempleo")
proc_data$confianza_en_extranjeros <- set_label(x = proc_data$confianza_en_extranjeros, label = "Nivel de confianza en inmigrantes")
proc_data$fomentar_migracion_calificada <- set_label(x = proc_data$fomentar_migracion_calificada, label = "Nivel de acuerdo con fomentar la inmigración calificada")
proc_data$acceso_igualitario_salud <- set_label(x = proc_data$acceso_igualitario_salud, label = "Nivel de acuerdo con que exista un ingreso igualitario a la salud")
proc_data$acuerdo_restriccion_inmigrantes <- set_label(x = proc_data$acuerdo_restriccion_inmigrantes, label = "Nivel de acuerdo con restringir el acceso a inmigrantes")
get_label(proc_data)

#Guardando la base de datos con las variables procesadas. 
save(proc_data, file="ipo/input/data-proc/variables_operacionalizadas.RData")

#visualización de datos
pacman::p_load(sjlabelled,
               dplyr, #Manipulacion de datos
               stargazer, #Tablas
               sjmisc, # Tablas
               summarytools, # Tablas
               kableExtra, #Tablas
               sjPlot, #Tablas y gráficos
               corrplot, # Correlaciones
               sessioninfo, # Información de la sesión de trabajo
               ggplot2) # Para la mayoría de los gráficos
stargazer(proc_data,type = "text")
summarytools::dfSummary(proc_data, plain.ascii = FALSE)
